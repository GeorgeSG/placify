<script type="text/javascript" src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBecQFBm2kABATZyBg_qg-E7DgurxYhxE0&sensor=false"></script>
<script type="text/javascript" src="js/map-helpers.js"></script>
<script type="text/javascript">
  _m = google.maps;

  function initialize() {
    var $window = $(window);
    var $canvas = $("#map-canvas");

    function resizeCanvas() {
      $canvas.height($(window).height() - 160);
    }

    resizeCanvas();

    $window.resize(function() {
      resizeCanvas();
    });

    var mapOptions = {
        center: latLng(42.695, 23.347),
        zoom: 12
    };

    map        = new _m.Map($canvas[0], mapOptions);
    infoWindow = new _m.InfoWindow();

    _m.event.addListener(map, 'center_changed', function() {});

    _m.event.addListener(map, 'click', function(event) {
        placeMarker(map, event.latLng, "New Point", true);
    });

    $.getJSON("/mock/points.json", function(json) {
        loadMarkers(json.markers);
    }).fail(function() {
      console.log('Failed Loading JSON!');
    });

    function loadMarkers(markers) {
      $.each(markers, function(index, element) {
        position = latLng(element.lat, element.lng);
        var marker = placeMarker(map, position, element.name, true);

        _m.event.addListener(marker, 'click', function() {
          infoWindow.close();
          infoWindow.setContent(element.description)
          infoWindow.open(map, marker);
        });

        _m.event.addListener(marker, 'dragend', function() {
          console.log('marker position changed to:');
          console.log(marker.getPosition());
        })
      });
    }
  }

  _m.event.addDomListener(window, 'load', initialize);
</script>

<div id="map-canvas"></div>
