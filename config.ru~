require 'rubygems'
require 'bundler/setup'

module Placify

  ENV['RACK_ENV'] ||= 'development'
  Bundler.require :default

  class Base < Sinatra::Base
    register Sinatra::ConfigFile
    config_file 'config.yml'

    set :views,         File.expand_path(settings.views_path,  __FILE__)
    set :public_folder, File.expand_path(settings.public_path, __FILE__)

    enable :sessions

    Mongoid.load!('mongoid.yml', __FILE__)
    #Mongoid.load!(File.expand_path('.mongoid.yml', __FILE__))
    
  end
end

Dir.glob('./controllers/**/*.rb').each do |controller|
  require controller
end

Dir.glob('./database/models/*.rb').each do |model|
  require model
end

controllers = [
  Placify::MainController,
  Placify::PlacesController,
]

controllers.each do |controller|
  map(controller::NAMESPACE) { run controller }
end
